schema_version: "1.0"

pr:
  number: 60007
  title: "Add superscript capital C, F, Q"
  url: "https://github.com/JuliaLang/julia/pull/60007"
  author: "Technici4n"
  labels: []
  merged_at: "2025-11-01T12:37:21Z"
  merge_commit_sha: "92d882354362d87199fe980c108e45dbf126fbcf"
  diff_url: "https://github.com/JuliaLang/julia/pull/60007.diff"

scope:
  files_touched:
    - "stdlib/REPL/src/latex_symbols.jl"
    - "stdlib/REPL/test/replcompletions.jl"
  components:
    - "REPL"
    - "stdlib"
  pipeline_stages: []
  compiler_relevant: false

analysis:
  intent:
    summary: |
      Adds three missing Unicode superscript capital letters (C, F, Q) to the REPL's LaTeX
      tab-completion system. Previously, uppercase superscript letters \^C, \^F, and \^Q
      were missing from the latex_symbols dictionary, meaning users couldn't tab-complete
      these characters. The PR fills gaps in the superscript alphabet using Unicode
      characters from the Latin Extended-D block.
    issue_links: []
    rationale: |
      The latex_symbols dictionary previously had gaps for uppercase superscript letters
      C, F, and Q. Other capital letters like A, B, D, E, G, etc. already had superscript
      mappings. This PR adds consistency by providing Unicode characters:
      - \^C -> êŸ² (U+A7F2 MODIFIER LETTER CAPITAL C)
      - \^F -> êŸ³ (U+A7F3 MODIFIER LETTER CAPITAL F)
      - \^Q -> êŸ´ (U+A7F4 MODIFIER LETTER CAPITAL Q)

      PR author notes these characters are from the Latin Extended-D block (U+A7F2-A7F4),
      which contains modifier letters. The existing superscript capitals (A, B, D-P, R, T-W)
      are mostly from the Phonetic Extensions block (U+1D2C-U+1D6A). The new characters
      were chosen based on Wikipedia's Unicode subscripts and superscripts tables.
      Reference: https://en.wikipedia.org/wiki/Unicode_subscripts_and_superscripts

  direct_changes:
    - summary: "Add superscript capital C, F, Q to latex_symbols dictionary"
      component: "stdlib/REPL"
      change_type: "feature"
      evidence:
        - source: "code"
          path: "stdlib/REPL/src/latex_symbols.jl"
          loc: "206-220"
          url: "https://github.com/JuliaLang/julia/blob/92d882354362d87199fe980c108e45dbf126fbcf/stdlib/REPL/src/latex_symbols.jl#L206-L220"
          snippet: |
            "\\^A" => "á´¬",
            "\\^B" => "á´®",
            "\\^C" => "êŸ²",
            "\\^D" => "á´°",
            "\\^E" => "á´±",
            "\\^F" => "êŸ³",
            "\\^G" => "á´³",
            "\\^H" => "á´´",
            "\\^I" => "á´µ",
            "\\^J" => "á´¶",
            "\\^K" => "á´·",
            "\\^L" => "á´¸",
            "\\^M" => "á´¹",
            "\\^N" => "á´º",
            "\\^O" => "á´¼",
            "\\^P" => "á´¾",
            "\\^Q" => "êŸ´",
            "\\^R" => "á´¿",
            "\\^T" => "áµ€",

    - summary: "Update test expectations for superscript completion"
      component: "stdlib/REPL/test"
      change_type: "test"
      evidence:
        - source: "test"
          path: "stdlib/REPL/test/replcompletions.jl"
          loc: "1521-1532"
          url: "https://github.com/JuliaLang/julia/blob/92d882354362d87199fe980c108e45dbf126fbcf/stdlib/REPL/test/replcompletions.jl#L1521-L1532"
          snippet: |
            @testset "sub/superscripts" begin
                @test "â½Â¹Â²Â³â¾â¿" in test_complete("\\^(123)n")[1]
                @test "â¿" in test_complete("\\^n")[1]
                @test "áµž" in test_complete("\\^gamma")[1]
                @test "â½Â¹Â²Â³â¾â¿ðž¥" in test_complete("\\^(123)nq")[1]
                @test "â½Â¹Â²Â³â¾â¿êŸ´" in test_complete("\\^(123)nQ")[1]
                @test isempty(test_complete("\\^(123)nX")[1])
                @test "â‚â‚â‚‚â‚ƒâ‚Žâ‚™" in test_complete("\\_(123)n")[1]
                @test "â‚™" in test_complete("\\_n")[1]
                @test "áµ§" in test_complete("\\_gamma")[1]
                @test isempty(test_complete("\\_(123)nq")[1])
            end

  secondary_effects:
    - effect: "superscripts dictionary expansion"
      mechanism: |
        latex_symbols Dict (latex_symbols.jl:99)
          -> superscripts Dict built via comprehension (REPLCompletions.jl:851):
             const superscripts = Dict(k[3]=>v[1] for (k,v) in latex_symbols if startswith(k, "\\^") && length(k)==3)
          -> new entries 'C'=>'êŸ²', 'F'=>'êŸ³', 'Q'=>'êŸ´' added to superscripts
          -> enables chained superscript completion like "\\^CFQ" -> "êŸ²êŸ³êŸ´"
      downstream_surfaces:
        - "REPL superscript chaining"
      likelihood: "high"
      impact: "low"
      evidence:
        - source: "code"
          path: "stdlib/REPL/src/REPLCompletions.jl"
          loc: "851-852"
          url: "https://github.com/JuliaLang/julia/blob/92d882354362d87199fe980c108e45dbf126fbcf/stdlib/REPL/src/REPLCompletions.jl#L851-L852"
          snippet: |
            const superscripts = Dict(k[3]=>v[1] for (k,v) in latex_symbols if startswith(k, "\\^") && length(k)==3)
            const superscript_regex = Regex("^\\\\\\^[" * join(isdigit(k) || isletter(k) ? "$k" : "\\$k" for k in keys(superscripts)) * "]+\\z")

    - effect: "superscript_regex pattern update"
      mechanism: |
        The superscript_regex (REPLCompletions.jl:852) is dynamically built from superscripts Dict keys:
          const superscript_regex = Regex("^\\\\\\^[" * join(...keys(superscripts)...) * "]+\\z")
        After this PR, the regex character class now includes 'C', 'F', 'Q'.
        This enables chained completions like:
          - "\\^(123)nQ" now matches and completes (test at replcompletions.jl:1526)
          - Previously "\\^(123)nQ" would fail to match the regex
      downstream_surfaces:
        - "REPL bslash_completions"
      likelihood: "high"
      impact: "low"
      evidence:
        - source: "code"
          path: "stdlib/REPL/src/REPLCompletions.jl"
          loc: "866-868"
          url: "https://github.com/JuliaLang/julia/blob/92d882354362d87199fe980c108e45dbf126fbcf/stdlib/REPL/src/REPLCompletions.jl#L866-L868"
          snippet: |
            elseif occursin(superscript_regex, s)
                sup = map(c -> superscripts[c], s[3:end])
                return (true, (Completion[BslashCompletion(sup)], slashpos:pos, true))

    - effect: "symbol_latex reverse lookup inclusion"
      mechanism: |
        The symbol_latex() function (docview.jl:498-510) builds a reverse lookup Dict:
          for (k,v) in REPLCompletions.latex_symbols
              symbols_latex[v] = k
          end
        New entries will be included:
          - 'êŸ²' => "\\^C"
          - 'êŸ³' => "\\^F"
          - 'êŸ´' => "\\^Q"
        This enables users to query help for these symbols and get their LaTeX input.
      downstream_surfaces:
        - "REPL help system"
        - "Documentation lookup"
      likelihood: "high"
      impact: "low"
      evidence:
        - source: "code"
          path: "stdlib/REPL/src/docview.jl"
          loc: "498-510"
          url: "https://github.com/JuliaLang/julia/blob/92d882354362d87199fe980c108e45dbf126fbcf/stdlib/REPL/src/docview.jl#L498-L510"
          snippet: |
            function symbol_latex(s::String)
                if isempty(symbols_latex)
                    for (k,v) in Iterators.flatten((REPLCompletions.latex_symbols,
                                                    REPLCompletions.emoji_symbols))
                        symbols_latex[v] = k
                    end
                    merge!(symbols_latex, REPLCompletions.symbols_latex_canonical)
                end
                return get(symbols_latex, s, "")
            end

    - effect: "Documentation table automatic update"
      mechanism: |
        The Unicode input documentation (doc/src/manual/unicode-input.md) dynamically generates
        its table from latex_symbols:
          table_entries(tab_completions(REPL.REPLCompletions.latex_symbols, ...))
        The new symbols will automatically appear in the generated documentation without
        any manual doc changes required.
      downstream_surfaces:
        - "Julia manual Unicode input table"
      likelihood: "high"
      impact: "low"
      evidence:
        - source: "code"
          path: "doc/src/manual/unicode-input.md"
          loc: "86-92"
          url: "https://github.com/JuliaLang/julia/blob/92d882354362d87199fe980c108e45dbf126fbcf/doc/src/manual/unicode-input.md#L86-L92"
          snippet: |
            table_entries(
                tab_completions(
                    REPL.REPLCompletions.latex_symbols,
                    REPL.REPLCompletions.emoji_symbols
                ),
                unicode_data()
            )

  compatibility:
    internal_api: []
    behavioral:
      - area: "REPL tab-completion"
        change: "New completions available"
        description: |
          Users can now type \^C, \^F, or \^Q followed by Tab to insert the
          corresponding superscript Unicode characters (êŸ², êŸ³, êŸ´). These are
          additive changes with no breaking impact.
        breaking: false

  performance:
    compile_time: []
    runtime:
      - area: "REPL startup"
        impact: "negligible"
        description: |
          Three additional dictionary entries in latex_symbols.
          ESTIMATED: <0.001% impact on REPL initialization time.

  risk:
    level: "low"
    rationale:
      - "Change is strictly additive - only adds new dictionary entries"
      - "No compiler, type inference, or codegen changes"
      - "Only affects user-facing REPL tab-completion feature"
      - "Unicode characters used are from stable Unicode blocks"
      - "Test coverage added for new completions"

  open_questions:
    - question: "Remaining gaps in uppercase superscript alphabet"
      context: |
        After this PR, the following uppercase letters still lack superscript completions:
        S, X, Y, Z (line 222 jumps from T to U, then W follows V at line 225).
        The test at replcompletions.jl:1527 confirms X has no completion:
          @test isempty(test_complete("\\^(123)nX")[1])
        This is expected - Unicode does not define modifier letter capitals for all letters.

  recommendations:
    - "No action required for downstream packages"
    - "This is a user-experience enhancement only"

  downstream_impact:
    packages_affected: []
    summary: |
      This PR has NO impact on downstream compiler tooling packages (JET, Enzyme,
      GPUCompiler, IRTools, Cassette, etc.). It only modifies the REPL's
      tab-completion feature for LaTeX-style Unicode input. No compiler internals,
      IR formats, or APIs are affected.

  classification:
    is_compiler_change: false
    is_stdlib_change: true
    affects_type_inference: false
    affects_codegen: false
    affects_optimization: false
    affects_parsing: false
    affects_lowering: false
    user_visible: true
    user_visible_description: "New REPL tab-completions for \\^C, \\^F, \\^Q"
